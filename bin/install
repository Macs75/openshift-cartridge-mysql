#!/bin/bash

source $OPENSHIFT_CARTRIDGE_SDK_BASH

# Add DB_HOST and DB_PORT environment variables
if [ -z "$OPENSHIFT_MYSQL_PROXY_PORT" ]; then
  # Since $OPENSHIFT_MYSQL_PROXY_PORT is missing, cartridge must be running in the main gear
  echo "$OPENSHIFT_MYSQL_DB_HOST" > $OPENSHIFT_MYSQL_DIR/env/DB_HOST
  echo "$OPENSHIFT_MYSQL_DB_PORT" > $OPENSHIFT_MYSQL_DIR/env/DB_PORT
else
  # Found $OPENSHIFT_MYSQL_PROXY_PORT, the cartridge is running in a separate gear
  echo "$OPENSHIFT_GEAR_DNS" > $OPENSHIFT_MYSQL_DIR/env/DB_HOST
  echo "$OPENSHIFT_MYSQL_DB_PROXY_PORT" > $OPENSHIFT_MYSQL_DIR/env/DB_PORT
fi

# Output result
client_result "MySQL ${2} installed."
client_result "The initial root password will be set to 'root', make sure to change it!"
client_result "Use \$DB_HOST and \$DB_PORT environment variables to connect your application."
